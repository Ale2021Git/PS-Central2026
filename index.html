<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="format-detection" content="telephone=no, date=no, address=no, email=no">
    <meta name="theme-color" content="#002094">
    <title>Escala PS Central - Dr. Armando</title>

    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Escala PS">
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/192/medical-heart.png">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=JetBrains+Mono:wght@700&display=swap');
        
        :root {
            --ps-pantone287: #002094;
            --ps-med: #00549F; 
            --ps-light: #E0F2FE;
            --bg: #F8FAFC; 
            --card: #FFFFFF; 
            --text: #1E293B;
            --neon: #00E5FF; 
            --border: #CBD5E1;
            --gold: #FFD700;
            --danger: #ef4444;
            --defesa: #f59e0b;
            --policia: #1e293b;
        }

        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; overflow-x: hidden; }

        header { 
            background: var(--ps-pantone287); 
            padding: calc(15px + env(safe-area-inset-top)) 15px 15px 15px; 
            color: white; display: flex; align-items: center; justify-content: space-between;
            position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .title-group { flex-grow: 1; }
        .title-main { font-size: 0.75em; font-weight: 800; text-transform: uppercase; display: block; letter-spacing: 0.5px; }
        .title-sub { font-size: 0.55em; opacity: 0.8; display: block; }
        
        .header-actions { display: flex; gap: 8px; }
        .btn-header {
            width: 38px; height: 38px; display: flex; align-items: center; justify-content: center;
            background: rgba(255, 255, 255, 0.12); border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 10px; color: white; cursor: pointer;
        }

        .status-panel { 
            background: var(--card); border-radius: 20px; padding: 15px; margin: 15px; 
            border: 1px solid var(--border); text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .clock { font-family: 'JetBrains Mono', monospace; font-size: 2.2em; color: var(--ps-pantone287); letter-spacing: -1px; margin-bottom: 5px; }
        
        #status-badge { 
            font-weight: 900; font-size: 1.25em; text-transform: uppercase; 
            padding: 12px 28px; border-radius: 50px; display: inline-flex; 
            align-items: center; gap: 10px; margin-top: 5px; transition: 0.3s;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
        }

        .selector-container { margin: 0 15px 15px 15px; }
        select { 
            width: 100%; padding: 12px; border-radius: 12px; font-weight: 800; font-size: 1em;
            border: 2px solid var(--ps-pantone287); color: var(--ps-pantone287); background: white;
            text-align-last: center; outline: none; appearance: none;
        }

        .mes-container { margin: 0 15px 25px 15px; height: 360px; perspective: 1000px; }
        .mes-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .mes-inner.flipped { transform: rotateY(180deg); }
        .mes-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 15px; padding: 12px; border: 1px solid var(--border); background: var(--card); }
        .mes-back { transform: rotateY(180deg); background: var(--ps-pantone287); color: white; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 12px; }

        .mes-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 12px; padding: 0 5px; cursor: pointer; }
        .mes-nome { margin: 0; text-transform: capitalize; color: var(--ps-pantone287); font-weight: 800; font-size: 1.3em; }
        .ano-destaque { color: var(--ps-pantone287); font-size: 1.4em; font-weight: 900; opacity: 0.9; }

        .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; }
        .dia-sem { font-size: 0.6em; font-weight: 800; color: #64748B; text-transform: uppercase; padding-bottom: 5px; }
        .dia { aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-weight: 700; font-size: 0.85em; position: relative; cursor: pointer; }
        
        .BG-ESCURO { background: var(--ps-med) !important; color: white !important; }
        .BG-CLARO { background: var(--ps-light) !important; color: var(--ps-pantone287) !important; }
        .FERIADO { border: 2px solid var(--gold) !important; }
        
        @keyframes pulse-hoje {
            0% { box-shadow: 0 0 0 0 rgba(0, 229, 255, 0.7); }
            50% { box-shadow: 0 0 0 12px rgba(0, 229, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 229, 255, 0); }
        }
        .hoje { border: 3px solid var(--neon) !important; animation: pulse-hoje 2s infinite; z-index: 10; }
        .HAS_NOTE::after { content: ''; position: absolute; top: 4px; right: 4px; width: 6px; height: 6px; background: var(--danger); border-radius: 50%; border: 1px solid white; }

        .bottom-modal { position: fixed; bottom: -100%; left: 0; right: 0; background: white; border-radius: 25px 25px 0 0; padding: 20px; z-index: 2000; transition: 0.4s; max-height: 85vh; overflow-y: auto; }
        .bottom-modal.show { bottom: 0; box-shadow: 0 -5px 25px rgba(0,0,0,0.2); }
        #overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1500; backdrop-filter: blur(3px); }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .stat-item { background: #F1F5F9; padding: 12px; border-radius: 15px; text-align: center; color: inherit; text-decoration: none; }
        .stat-val { display: block; font-weight: 800; color: var(--ps-pantone287); font-size: 1.3em; }

        .btn-save { background: var(--ps-pantone287); color: white; border: none; padding: 15px; border-radius: 12px; width: 100%; font-weight: 800; margin-top: 10px; }
        .btn-close-modal { background: #F1F5F9; color: var(--text); border: none; padding: 12px; border-radius: 12px; width: 100%; margin-top: 8px; font-weight: 700; }

        footer { background: var(--ps-pantone287); color: white; text-align: center; padding: 30px 20px; font-size: 0.75em; line-height: 1.6; }
        .footer-highlight { font-weight: 700; color: var(--neon); }
    </style>
</head>
<body>

<header>
    <div class="title-group">
        <span class="title-main">PS CENTRAL</span>
        <span class="title-sub">Dr. Armando G. S. Couto</span>
    </div>
    <div class="header-actions">
        <button class="btn-header" onclick="abrirModoUso()"><span class="material-symbols-outlined">help</span></button>
        <button class="btn-header" onclick="abrirStats()"><span class="material-symbols-outlined">analytics</span></button>
        <button class="btn-header" onclick="abrirTelefones()"><span class="material-symbols-outlined">call</span></button>
    </div>
</header>

<main>
    <div class="status-panel">
        <div id="big-clock" class="clock">00:00:00</div>
        <div id="status-badge">CARREGANDO...</div>
    </div>
    <div class="selector-container">
        <select id="turmaSelect" onchange="gerar()">
            <option value="A">EQUIPE A</option>
            <option value="B">EQUIPE B</option>
        </select>
    </div>
    <div id="calendario-box"></div>
</main>

<footer>
    <div class="footer-line">Sistema de Gestão de Escala Médica • 2026</div>
    <div class="footer-highlight">Pronto Socorro Central Dr. Armando G. S. Couto</div>
    <div class="footer-line" style="margin-top:10px; font-size: 0.8em;">Desenvolvido por: alelacerd@gmail.com</div>
</footer>

<div id="overlay" onclick="fecharTodosModais()"></div>

<div id="modalTelefones" class="bottom-modal">
    <h3 style="margin-bottom:15px">Contatos de Emergência</h3>
    <div style="display: flex; flex-direction: column; gap: 10px;">
        <a href="tel:2127121234" class="stat-item" style="text-align:left"><div><small style="display:block; font-weight:700; color:#64748B">RECEPÇÃO CENTRAL</small><b>(21) 2712-1234</b></div></a>
        <a href="tel:192" class="stat-item" style="text-align:left; border-left:5px solid var(--danger)"><div><small style="display:block; font-weight:700; color:var(--danger)">SAMU</small><b>192</b></div></a>
        <a href="tel:193" class="stat-item" style="text-align:left; border-left:5px solid var(--danger)"><div><small style="display:block; font-weight:700; color:var(--danger)">BOMBEIROS</small><b>193</b></div></a>
        <a href="tel:199" class="stat-item" style="text-align:left; border-left:5px solid var(--defesa)"><div><small style="display:block; font-weight:700; color:var(--defesa)">DEFESA CIVIL</small><b>199</b></div></a>
        <a href="tel:190" class="stat-item" style="text-align:left; border-left:5px solid var(--policia)"><div><small style="display:block; font-weight:700; color:var(--policia)">POLÍCIA MILITAR</small><b>190</b></div></a>
    </div>
    <button class="btn-close-modal" onclick="fecharTodosModais()">VOLTAR</button>
</div>

<div id="modalStats" class="bottom-modal">
    <h3 style="margin-bottom:15px">Estatísticas 2026</h3>
    <div class="stat-grid">
        <div class="stat-item"><span id="s-p" class="stat-val">0</span><small>Plantões</small></div>
        <div class="stat-item"><span id="s-f" class="stat-val">0</span><small>Folgas</small></div>
    </div>
    <div class="stat-grid">
        <div class="stat-item" style="border-left: 4px solid var(--gold)"><span id="s-ft" class="stat-val">0</span><small>Feriados (Plantão)</small></div>
        <div class="stat-item" style="border-left: 4px solid var(--ps-light)"><span id="s-ff" class="stat-val">0</span><small>Feriados (Folga)</small></div>
    </div>
    <div class="stat-item" style="margin-top:10px; background: var(--ps-light); color: var(--ps-pantone287);">
        <small style="font-weight:800">CARGA HORÁRIA TOTAL</small>
        <div style="font-size:1.6em; font-weight:900;"><span id="total-horas">0</span>h</div>
    </div>
    <button class="btn-close-modal" onclick="fecharTodosModais()">FECHAR</button>
</div>

<div id="infoCard" class="bottom-modal">
    <h3 id="card-data" style="margin:0; color:var(--ps-pantone287)"></h3>
    <textarea id="noteInput" rows="4" style="width:100%; border:2px solid var(--border); border-radius:12px; padding:12px; font-size:16px; margin-top:15px; outline:none; font-family:inherit;" placeholder="Escreva uma nota..."></textarea>
    <button class="btn-save" onclick="salvarNota()">SALVAR</button>
    <button class="btn-close-modal" onclick="fecharTodosModais()">FECHAR</button>
</div>

<div id="modalUso" class="bottom-modal">
    <h3 style="margin-bottom:15px">Legenda de Equipes</h3>
    <p>• <b>Equipe A:</b> Plantão (Escuro) / Folga (Claro)</p>
    <p>• <b>Equipe B:</b> Plantão (Claro) / Folga (Escuro)</p>
    <button class="btn-close-modal" onclick="fecharTodosModais()">ENTENDI</button>
</div>

<script>
    // Registro do Service Worker para suporte Offline
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('SW registrado.'))
                .catch(err => console.log('Erro SW:', err));
        });
    }

    const feriados = { "2026-01-01": "Ano Novo", "2026-01-20": "Padroeiro", "2026-02-17": "Carnaval", "2026-04-03": "Paixão", "2026-04-21": "Tiradentes", "2026-04-23": "São Jorge", "2026-05-01": "Trabalho", "2026-06-04": "Corpus Christi", "2026-09-07": "Independência", "2026-10-12": "Aparecida", "2026-11-02": "Finados", "2026-11-15": "República", "2026-11-20": "Zumbi", "2026-12-25": "Natal" };
    const DB_KEY = "PS_CENTRAL_2026_V12";
    let dataAtiva = "";

    function checkTrabalho(dt, t) {
        const dataBase = new Date(2026, 0, 1);
        const diffDays = Math.floor((dt - dataBase) / (1000 * 60 * 60 * 24));
        return t === 'A' ? (diffDays % 2 === 0) : (diffDays % 2 !== 0);
    }

    function gerar() {
        const box = document.getElementById('calendario-box');
        const turma = document.getElementById('turmaSelect').value;
        const notas = JSON.parse(localStorage.getItem(DB_KEY) || '{}');
        const hoje = new Date(); hoje.setHours(0,0,0,0);
        box.innerHTML = "";
        let p=0, f=0, ft=0, ff=0;

        for (let m = 0; m < 12; m++) {
            const mNome = new Intl.DateTimeFormat('pt-BR', {month:'long'}).format(new Date(2026, m, 1));
            const totalDias = new Date(2026, m+1, 0).getDate();
            const primDia = new Date(2026, m, 1).getDay();
            const espacos = primDia === 0 ? 6 : primDia - 1;
            
            let diasHTML = `<div class="dia-sem">Seg</div><div class="dia-sem">Ter</div><div class="dia-sem">Qua</div><div class="dia-sem">Qui</div><div class="dia-sem">Sex</div><div class="dia-sem">Sáb</div><div class="dia-sem">Dom</div>`;
            for(let e=0; e<espacos; e++) diasHTML += `<div></div>`;

            let feriadosLista = "", notasLista = "";
            for(let d=1; d<=totalDias; d++) {
                const dt = new Date(2026, m, d);
                const iso = `2026-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const trab = checkTrabalho(dt, turma);
                
                if(trab) p++; else f++;
                if(feriados[iso]) {
                    feriadosLista += `• ${d}: ${feriados[iso]}<br>`;
                    trab ? ft++ : ff++;
                }
                if(notas[iso]) notasLista += `<div style="background:rgba(255,255,255,0.1); padding:8px; border-radius:8px; margin-bottom:5px; font-size:0.8em;"><b>Dia ${d}:</b> ${notas[iso]}</div>`;

                let corClasse = (turma === 'A') ? (trab ? 'BG-ESCURO' : 'BG-CLARO') : (trab ? 'BG-CLARO' : 'BG-ESCURO');
                let cls = `dia ${corClasse}`;
                if(dt.getTime() === hoje.getTime()) cls += " hoje";
                if(feriados[iso]) cls += " FERIADO";
                if(notas[iso]) cls += " HAS_NOTE";
                diasHTML += `<div class="${cls}" onclick="abrirModalNota('${iso}')">${d}</div>`;
            }

            const container = document.createElement('div');
            container.className = 'mes-container';
            container.innerHTML = `<div class="mes-inner" id="inner-${m}">
                <div class="mes-face">
                    <div class="mes-header" onclick="toggleFlip(${m})">
                        <h4 class="mes-nome">${mNome}</h4>
                        <span class="ano-destaque">2026</span>
                    </div>
                    <div class="grid">${diasHTML}</div>
                </div>
                <div class="mes-face mes-back" onclick="toggleFlip(${m})">
                    <div style="font-size:0.75em; font-weight:800; color:var(--neon); border-bottom:1px solid rgba(255,255,255,0.2); display:flex; justify-content:space-between;">RESUMO ${mNome.toUpperCase()} <span>2026</span></div>
                    <div style="font-size:0.65em; margin-top:5px;">${feriadosLista || "Sem feriados."}</div>
                    <div style="font-size:0.75em; font-weight:800; color:var(--neon); margin-top:10px; border-bottom:1px solid rgba(255,255,255,0.2)">ANOTAÇÕES</div>
                    <div style="overflow-y:auto; flex-grow:1; margin-top:5px;">${notasLista || "Toque no número para anotar."}</div>
                </div></div>`;
            box.appendChild(container);
        }
        document.getElementById('s-p').innerText = p; 
        document.getElementById('s-f').innerText = f;
        document.getElementById('s-ft').innerText = ft; 
        document.getElementById('s-ff').innerText = ff;
        document.getElementById('total-horas').innerText = p * 24;
        atualizarStatus();
    }

    function toggleFlip(idx) { document.getElementById(`inner-${idx}`).classList.toggle('flipped'); }
    function atualizarStatus() {
        const hoje = new Date(); hoje.setHours(0,0,0,0);
        const t = document.getElementById('turmaSelect').value;
        const trab = checkTrabalho(hoje, t);
        const el = document.getElementById('status-badge');
        el.innerHTML = trab ? '<span class="material-symbols-outlined">medical_services</span> HOJE: PLANTÃO' : '<span class="material-symbols-outlined">home</span> HOJE: FOLGA';
        el.style.background = trab ? 'var(--ps-pantone287)' : 'var(--ps-light)';
        el.style.color = trab ? 'white' : 'var(--ps-pantone287)';
    }

    function abrirModalNota(iso) { dataAtiva = iso; const notas = JSON.parse(localStorage.getItem(DB_KEY) || '{}'); document.getElementById('card-data').innerText = "Dia " + iso.split('-').reverse().join('/'); document.getElementById('noteInput').value = notas[iso] || ""; mostrarModal('infoCard'); }
    function salvarNota() { const notas = JSON.parse(localStorage.getItem(DB_KEY) || '{}'); const txt = document.getElementById('noteInput').value.trim(); txt ? notas[dataAtiva] = txt : delete notas[dataAtiva]; localStorage.setItem(DB_KEY, JSON.stringify(notas)); fecharTodosModais(); gerar(); }
    function mostrarModal(id) { document.getElementById('overlay').style.display = 'block'; document.getElementById(id).classList.add('show'); }
    function fecharTodosModais() { document.querySelectorAll('.bottom-modal').forEach(m => m.classList.remove('show')); document.getElementById('overlay').style.display = 'none'; }
    function abrirStats() { mostrarModal('modalStats'); }
    function abrirModoUso() { mostrarModal('modalUso'); }
    function abrirTelefones() { mostrarModal('modalTelefones'); }

    setInterval(() => { document.getElementById('big-clock').innerText = new Date().toLocaleTimeString('pt-BR'); }, 1000);
    window.onload = () => { gerar(); const m = new Date().getMonth(); setTimeout(() => { const el = document.getElementsByClassName('mes-container')[m]; if(el) window.scrollTo({ top: el.offsetTop - 120, behavior: 'smooth' }); }, 300); };
</script>
</body>
</html>
